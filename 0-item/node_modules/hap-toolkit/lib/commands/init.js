"use strict";var _path=_interopRequireDefault(require("path")),_fsExtra=_interopRequireDefault(require("fs-extra")),_prompt=_interopRequireDefault(require("prompt")),_chalk=_interopRequireDefault(require("chalk")),_utils=require("./utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function generate(e){return""===e&&(e="HelloWorld"),new Promise(function(a,o){promptName(e,_chalk.default.green("Init your Project"),function(e,t){if(e)o(e);else{var r=t.name;createProject(r,_path.default.join(process.cwd(),r)),a()}})})}function promptName(e,t,r){var a={properties:{name:{message:t,default:e}}};_prompt.default.start(),_prompt.default.get(a,r)}function createProject(e,t){if(_fsExtra.default.existsSync(t))return console.log(_chalk.default.red('the folder "'+t+'" exists! Please rename your project.'));if(!(0,_utils.mkdirsSync)(t))return console.log(_chalk.default.red('the folder "'+t+'" create failed!.'));var r=_path.default.join(__dirname,"../../templates/app/demo");copyFiles(t,r);var a={appName:e,toolkitVersion:require("../../package.json").version};["src/manifest.json","package.json"].map(function(e){return _path.default.join(t,e)}).forEach(function(e){var t=_fsExtra.default.readFileSync(e,"utf-8");t=(0,_utils.renderString)(t,a),_fsExtra.default.writeFileSync(e,t)})}function copyFiles(a,o){var e=[];(0,_utils.traverseDirSync)(o,e),e.forEach(function(e){var t=_path.default.relative(o,e),r=_path.default.join(a,t);_fsExtra.default.existsSync(r)?console.log(_chalk.default.yellow("file: ".concat(r," already existed."))):(console.log("".concat((0,_utils.relatCwd)(r)," created.")),_fsExtra.default.copySync(e,r))})}module.exports=generate;
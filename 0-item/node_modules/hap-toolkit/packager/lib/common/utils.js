"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.extend=extend,exports.merge=merge,exports.hyphenedToCamelCase=hyphenedToCamelCase,exports.camelCaseToHyphened=camelCaseToHyphened,exports.getNameByPath=getNameByPath,exports.getFileNameWithHash=getFileNameWithHash,exports.isEmptyObject=isEmptyObject,exports.isPlainObject=isPlainObject,exports.loadBabelModule=loadBabelModule,exports.getFilenameByPath=getFilenameByPath,exports.serialize=serialize,exports.sortFilesBy=sortFilesBy,exports.makeRequireString=makeRequireString,exports.stringifyLoaders=stringifyLoaders,exports.generateMap=generateMap,exports.consumeMap=consumeMap,exports.splitSourceLine=splitSourceLine,exports.print=print,exports.splitAttr=splitAttr,exports.isValidValue=isValidValue,exports.equals=equals,exports.resolvePath=resolvePath,exports.fileExists=fileExists,exports.getWebpackOptions=getWebpackOptions,exports.isUXRender=isUXRender,exports.isUXEntry=isUXEntry,exports.collectResFile=collectResFile,exports.lsdirdeep=lsdirdeep,Object.defineProperty(exports,"colorconsole",{enumerable:!0,get:function(){return _utils.colorconsole}}),Object.defineProperty(exports,"logWarn",{enumerable:!0,get:function(){return _utils.logWarn}}),Object.defineProperty(exports,"mkdirsSync",{enumerable:!0,get:function(){return _utils.mkdirsSync}}),exports.FRAG_TYPE=exports.UX_TYPE=void 0;var _path=_interopRequireDefault(require("path")),_loaderUtils=_interopRequireDefault(require("loader-utils")),_hashSum=_interopRequireDefault(require("hash-sum")),_fs=_interopRequireDefault(require("fs")),_sourceMap=require("source-map"),_utils=require("../../../lib/common/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function extend(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if("function"==typeof Object.assign)Object.assign.apply(Object,[e].concat(r));else{var o=r.shift();for(var a in o)e[a]=o[a];r.length&&extend.apply(void 0,[e].concat(r))}return e}function merge(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return r.length&&r.forEach(function(e){t=t.concat(e)}),t}function hyphenedToCamelCase(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})}function camelCaseToHyphened(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()})}function getNameByPath(e){return _path.default.basename(e).replace(/\..*$/,"")}function getFileNameWithHash(e,t){var r=_path.default.relative(".",e),n=(0,_hashSum.default)(r+t);return"./".concat(r,"?").concat(n)}function isEmptyObject(e){if(!e)return!0;for(var t in e)return!1;return!0}var toString=Object.prototype.toString,OBJECT_STRING="[object Object]";function isPlainObject(e){return toString.call(e)===OBJECT_STRING}function loadBabelModule(e){var t=_path.default.resolve(__dirname,"..","node_modules",e),r=_path.default.resolve(process.cwd(),"node_modules",e);return _fs.default.existsSync(t)?t:_fs.default.existsSync(r)?r:e}function getFilenameByPath(e){return _path.default.relative(".",e)}function serialize(e,t){var r=_typeof(e);if("undefined"===r)return e;if("function"===r)return e.toString();for(var n=[],o=-1,a="__FKS_".concat(Math.random().toString(16).slice(2,10),"_FKE__"),i=JSON.stringify(e,function(e,t){return"function"==typeof t?"":t});-1<i.indexOf(a);)a="_".concat(a,"_");var u=JSON.stringify(e,function(e,t){return"function"==typeof t?(n.push(t),a+ ++o):t},t),s=new RegExp('"'.concat(a,'(\\d+)"'),"g");return u=u.replace(s,function(e,t){return n[t].toString()})}function predicate(e){return"string"==typeof e?e===this.toString():this.match(e)}function sortFilesBy(e,o){var a=e.length;return e=e.sort(function(e,t){var r=o.findIndex(predicate,e),n=o.findIndex(predicate,t);return(r=-1===r?a:r)-(n=-1===n?a:n)})}function makeRequireString(e,t,r){return print({loader:t,filepath:r}),"require("+_loaderUtils.default.stringifyRequest(e,t?"!!".concat(t,"!").concat(r):"".concat(r))+")\n"}function stringifyLoaders(e){return e.map(function(e){if("string"==typeof e)return e;var t=e.name,r=[];if(e.query)for(var n in e.query){var o=e.query[n];null!=o&&(!0===o?r.push(n):o instanceof Array?r.push("".concat(n,"[]=").concat(o.join(","))):r.push("".concat(n,"=").concat(o)))}return"".concat(t).concat(r.length?"?"+r.join("&"):"")}).join("!")}function generateMap(e,t,r){var n=getFileNameWithHash(e.resourcePath),o=_path.default.resolve("."),a=new _sourceMap.SourceMapGenerator({sourceRoot:o,skipValidation:!0});a.setSourceContent(n,t);var i=!0,u=!1,s=void 0;try{for(var c,l=r[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var f=c.value,p=f.original,d=f.generated;a.addMapping({source:n,original:p,generated:d})}}catch(e){u=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(u)throw s}}return a}function consumeMap(e,t,r){var n,o=new _sourceMap.SourceMapConsumer(r),a=[],i=[],u={};return splitSourceLine(t).forEach(function(e,t){t+=1;var r=o.originalPositionFor({line:t,column:0});r.source&&(n=r.source,a.push({line:r.line,column:r.column}),i.push({line:t,column:0}),u["line-".concat(t,"-column-").concat(0)]={line:r.line,column:r.column})}),{source:n,original:a,generated:i,mapping:u,sourcesContent:o.sourcesContent}}var REGEXP_LINE=/\r?\n/g;function splitSourceLine(e){return e.split(REGEXP_LINE)}var showLog=!1;function print(e){if(showLog){var t="";if("string"==typeof e)t="######### "+e+" #########";else for(var r in e)t+="######### "+r+" : "+e[r]+" #########\n";console.log(t)}}function splitAttr(e,r){var n=[];if(r)switch(e.forEach(function(e,t){n[t]={},n[t].n=e}),r.length){case 1:e.forEach(function(e,t){n[t].v=r[0]});break;case 2:e.forEach(function(e,t){n[t].v=t%2?r[1]:r[0]});break;case 3:e.forEach(function(e,t){n[t].v=t%2?r[1]:r[t]});break;default:e.forEach(function(e,t){n[t].v=r[t]})}return n}function isValidValue(e){return"number"==typeof e||"string"==typeof e}function equals(e,t,r){if(r){for(var n=arguments.length,o=new Array(3<n?n-3:0),a=3;a<n;a++)o[a-3]=arguments[a];if(r.apply(void 0,[e,t].concat(o)))return!0}var i=Object.prototype.toString.call(e);if(i!==Object.prototype.toString.call(t))return!1;if("[object Null]"===i||"[object Undefined]"===i)return!0;if("[object Object]"!==i&&"[object Array]"!==i)return Object(e).toString()===Object(t).toString();var u={};Object.keys(e).forEach(function(e){return u[e]=!0}),Object.keys(t).forEach(function(e){return u[e]=!0});for(var s=Object.keys(u),c=0;c<s.length;c++){var l=s[c];if(!equals(e[l],t[l],r,l))return!1}return!0}function resolvePath(e,t){if(t&&!_path.default.isAbsolute(e)){var r=_path.default.join(_path.default.dirname(t),e),n=_path.default.relative(_path.default.resolve(".","./src"),r);e=_path.default.join("/",n).replace(/\\/g,"/")}return e}function fileExists(e,t){var r;if(_path.default.isAbsolute(e)){var n=process.cwd();r=_path.default.join(n,"./src",e)}else r=_path.default.resolve(t,"../",e);return _fs.default.existsSync(r)}function getWebpackOptions(e){return e.options||{}}function isUXRender(e){return e===UX_TYPE.PAGE||e===UX_TYPE.CARD}function isUXEntry(e){return e===UX_TYPE.PAGE||e===UX_TYPE.APP||e===UX_TYPE.CARD}function collectResFile(i,u,s,c,l){var f,p=5<arguments.length&&void 0!==arguments[5]?arguments[5]:".",d=_path.default.join(u,p),h={};return i.readdirSync(d).forEach(function(e){var t=_path.default.join(d,e),r=i.statSync(t),n=_path.default.basename(t),o=_path.default.extname(t);if(r.isFile())l.indexOf(n)<0&&("manifest.json"===n||c.indexOf(o)<0)&&(f=(f=_path.default.join(s,p,_path.default.basename(e))).replace(/\\/g,"/"),h[f]=t);else if(r.isDirectory()){var a=_path.default.join(p,e);Object.assign(h,collectResFile(i,u,s,c,l,a))}}),h}function lsdirdeep(e){return function n(o,a,i){var u=[],s=_path.default.posix.join(o,a);return i.readdirSync(s).forEach(function(e){var t=_path.default.posix.join(s,e),r=_path.default.posix.join(a,e);i.statSync(t).isFile()?u.push(r):u=u.concat(n(o,r,i))}),u}(e,".",1<arguments.length&&void 0!==arguments[1]?arguments[1]:_fs.default)}var UX_TYPE={APP:"app",PAGE:"page",COMP:"comp",CARD:"card"};exports.UX_TYPE=UX_TYPE;var FRAG_TYPE={IMPORT:"import",TEMPLATE:"template",STYLE:"style",SCRIPT:"script"};exports.FRAG_TYPE=FRAG_TYPE;
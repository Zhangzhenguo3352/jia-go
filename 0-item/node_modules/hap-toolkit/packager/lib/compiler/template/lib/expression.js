"use strict";var _require=require("@babel/core"),transformSync=_require.transformSync,babelPlugin=require("@babel/plugin-transform-template-literals"),allowedKeywords="Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat,RegExp",allowedKeywordsRE=new RegExp("^("+allowedKeywords.replace(/,/g,"\\b|")+"\\b)"),improperKeywords="break,case,class,catch,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,let,return,super,switch,throw,try,var,while,with,yield,enum,await,implements,package,protected,static,interface,private,public",improperKeywordsRE=new RegExp("^("+improperKeywords.replace(/,/g,"\\b|")+"\\b)"),wsRE=/\s/g,newlineRE=/\n/g,saveRE=/[{,]\s*[\w$_]+\s*:|('(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*")|new |typeof |void /g,restoreRE=/"(\d+)"/g,pathTestRE=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*$/,identRE=/[^\w$.](?:[A-Za-z_$][\w$]*)/g,booleanLiteralRE=/^(?:true|false)$/,saved=[];function save(e,r){var t=saved.length;return saved[t]=r?e.replace(newlineRE,"\\n"):e,'"'+t+'"'}function rewrite(e){var r=e.charAt(0),t=e.slice(1);return allowedKeywordsRE.test(t)?e:r+"this."+(t=-1<t.indexOf('"')?t.replace(restoreRE,restore):t)}function restore(e,r){return saved[r]}function compileGetter(e){improperKeywordsRE.test(e)&&console.warn("### App Toolkit ### 不要在表达式中使用保留关键字: "+e),saved.length=0;var r=e.replace(saveRE,save).replace(wsRE,"");return(r=(" "+r).replace(identRE,rewrite).replace(restoreRE,restore)).trim()}function parseExpression(e){e=e.trim();if(/^\/.+\/[gimy]*$/.test(e))return e;return/^`.+`$/.test(e)?parseExpression(transformSync(e,{plugins:[babelPlugin]}).code):isSimplePath(e)&&e.indexOf("[")<0?"this."+e:compileGetter(e)}function isSimplePath(e){return pathTestRE.test(e)&&!booleanLiteralRE.test(e)&&"Math."!==e.slice(0,5)}module.exports={parseExpression:parseExpression};
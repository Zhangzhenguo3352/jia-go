"use strict";var _pluginSyntaxJsx=_interopRequireDefault(require("@babel/plugin-syntax-jsx"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}module.exports=function(e){var s=e.types;return{inherits:_pluginSyntaxJsx.default,visitor:{JSXNamespacedName:function(e){throw e.buildCodeFrameError("不支持带命名空间的标签/属性")},JSXElement:{exit:function(e,i){var t,n=function(e,i){e.parent.children=s.react.buildChildren(e.parent);var n,r=o(e.node.name),t=[];s.isIdentifier(r)?(n=r.name,t.push(s.stringLiteral(n))):t.push(r);var a=e.node.attributes;a=a.length?function(e){var i=[],n=[],r=!1;function t(){i.length&&(n.push(s.objectExpression(i)),i=[])}for(;e.length;){var a=e.shift();s.isJSXSpreadAttribute(a)?(t(),r=!0,n.push(a.argument)):i.push(l(a))}t(),e=r?(n.unshift(s.objectExpression([])),s.callExpression(s.identifier("__extend"),n)):n[0];return e}(a):s.nullLiteral();return t.push(a),s.callExpression(s.identifier("__elem"),t)}(e.get("openingElement")),r=o(e.get("openingElement").node.name);s.isIdentifier(r)&&(t=r.name);var a=e.node.children.map(function(e){return s.isStringLiteral(e)?(i="text"===t?"span":"text",n=e.value,(r=[]).push(s.stringLiteral(i)),r.push(s.objectExpression([s.objectProperty(s.identifier("value"),s.callExpression(s.identifier("__s"),[s.stringLiteral(n)]))])),s.callExpression(s.identifier("__elem"),r)):e;var i,n,r});n.arguments.push(s.arrayExpression(a)),e.replaceWith(s.inherits(n,e.node))}},Program:function(e){e.traverse({"ObjectMethod|FunctionExpression|ClassMethod":function(e){var i={hasJsx:!1};e.traverse({JSXElement:function(){this.hasJsx=!0}},i),i.hasJsx&&(e.get("body").unshiftContainer("body",s.variableDeclaration("const",[s.variableDeclarator(s.identifier("__s"),s.memberExpression(s.thisExpression(),s.identifier("$stringify")))])),e.get("body").unshiftContainer("body",s.variableDeclaration("const",[s.variableDeclarator(s.identifier("__extend"),s.memberExpression(s.thisExpression(),s.identifier("$extend")))])),e.get("body").unshiftContainer("body",s.variableDeclaration("const",[s.variableDeclarator(s.identifier("__elem"),s.memberExpression(s.thisExpression(),s.identifier("$createElement")))])))}})}}};function o(e){return s.isJSXIdentifier(e)&&(e.type="Identifier"),e}function l(e){var i,n=(i=e.value||s.booleanLiteral(!0),s.isJSXExpressionContainer(i)?i.expression:i);return s.isStringLiteral(n)&&!s.isJSXExpressionContainer(e.value)&&(n.value=n.value.replace(/\n\s+/g," ")),s.isValidIdentifier(e.name.name)?e.name.type="Identifier":e.name=s.stringLiteral(e.name.name),s.inherits(s.objectProperty(e.name,n),e)}};